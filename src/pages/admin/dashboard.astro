---
import AdminLayout from '../../layouts/AdminLayout.astro';
import { db } from '../../lib/db';
import { categories, projects, categoryImages, projectImages } from '../../lib/db/schema';
import { eq } from 'drizzle-orm';

// Get stats
const allCategories = await db.select().from(categories).all();
const allProjects = await db.select().from(projects).all();
const allCategoryImages = await db.select().from(categoryImages).all();
const allProjectImages = await db.select().from(projectImages).all();

// Filter non-project categories for display
const regularCategories = allCategories.filter(cat => !cat.isProjectCategory);

const stats = {
  categoriesCount: regularCategories.length,
  projectsCount: allProjects.length,
  totalImages: allCategoryImages.length + allProjectImages.length,
};
---

<AdminLayout title="Dashboard - Admin">
  <h1 class="text-3xl font-bold mb-8">Dashboard</h1>

  <!-- Stats -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
    <div class="bg-white rounded-lg p-6 shadow-sm">
      <div class="text-gray-600 text-sm mb-1">Categorías</div>
      <div class="text-3xl font-bold">{stats.categoriesCount}</div>
      <a href="/admin/categories" class="text-sm text-gray-600 hover:text-gray-900 mt-2 inline-block">
        Ver todas →
      </a>
    </div>

    <div class="bg-white rounded-lg p-6 shadow-sm">
      <div class="text-gray-600 text-sm mb-1">Proyectos</div>
      <div class="text-3xl font-bold">{stats.projectsCount}</div>
      <a href="/admin/projects" class="text-sm text-gray-600 hover:text-gray-900 mt-2 inline-block">
        Ver todos →
      </a>
    </div>

    <div class="bg-white rounded-lg p-6 shadow-sm">
      <div class="text-gray-600 text-sm mb-1">Imágenes totales</div>
      <div class="text-3xl font-bold">{stats.totalImages}</div>
      <p class="text-sm text-gray-500 mt-2">
        En categorías y proyectos
      </p>
    </div>
  </div>

  <!-- Quick actions -->
  <div class="bg-white rounded-lg p-6 shadow-sm">
    <h2 class="text-xl font-semibold mb-4">Acciones rápidas</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <a
        href="/admin/projects/create"
        class="p-4 border border-gray-200 rounded-lg hover:border-gray-900 transition-colors"
      >
        <h3 class="font-medium mb-1">Nuevo proyecto</h3>
        <p class="text-sm text-gray-600">Crear un nuevo proyecto</p>
      </a>

      <a
        href="/admin/categories"
        class="p-4 border border-gray-200 rounded-lg hover:border-gray-900 transition-colors"
      >
        <h3 class="font-medium mb-1">Gestionar imágenes</h3>
        <p class="text-sm text-gray-600">Subir y organizar fotos por categoría</p>
      </a>
    </div>
  </div>
</AdminLayout>
