---
import AdminLayout from '../../../layouts/AdminLayout.astro';
import { db } from '../../../lib/db';
import { categories, categoryImages } from '../../../lib/db/schema';
import { asc, eq, count } from 'drizzle-orm';

// Get all categories with image count
const allCategories = await db
  .select({
    id: categories.id,
    slug: categories.slug,
    name: categories.name,
    order: categories.order,
    isProjectCategory: categories.isProjectCategory,
    imageCount: count(categoryImages.id),
  })
  .from(categories)
  .leftJoin(categoryImages, eq(categories.id, categoryImages.categoryId))
  .groupBy(categories.id)
  .orderBy(asc(categories.order))
  .all();
---

<AdminLayout title="Categorías - Admin">
  <div class="max-w-7xl">
    <h1 class="text-3xl font-bold mb-8">Categorías</h1>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {allCategories.filter(cat => !cat.isProjectCategory).map(category => (
        <a
          href={`/admin/categories/${category.slug}`}
          class="bg-white rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow"
        >
          <h3 class="text-xl font-semibold mb-2">{category.name}</h3>
          <p class="text-gray-600">{category.imageCount} imagen(es)</p>
        </a>
      ))}
    </div>
  </div>
</AdminLayout>
